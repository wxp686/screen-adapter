import{isVue2 as t,nextTick as e,isVue3 as n}from"vue-demi";var i=function(){function i(i,o){var a=this;if(this.Vue={},this.rootFontSize=0,this.externalCallbacks=[],this.adaptOptions=[],this.nextTick=null,this.configVue=function(e){var n;a.Vue=e,n=a,t?(a.Vue.mixin({data:function(){return{screenAdapter:n}},methods:{px:a.px}}),a.Vue.directive("scale",{inserted:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],o=t[1];i.style.flexShrink=0,i.style.flexGrow=0,n.nextTick((function(){n.wrapDiv(i),i.originOffsetWidth=i.offsetWidth/n.getScale(),i.originOffsetHeight=i.offsetHeight/n.getScale(),i.style.transformOrigin="left top",i.style.width=i.originOffsetWidth+"px",i.style.height=i.originOffsetHeight+"px",n.handlerScale({el:i,value:o.value}),n.updateAdaptOptions.apply(n,t)}))},update:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.updateAdaptOptions.apply(n,t)},unbind:function(t){var e=n.adaptOptions.findIndex((function(e){return e.el===t}));e>-1&&n.adaptOptions.splice(e,1)}})):(a.Vue.mixin({data:function(){return{screenAdapter:n}},methods:{px:a.px}}),a.Vue.directive("scale",{created:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],o=t[1];i.style.flexShrink=0,i.style.flexGrow=0,n.nextTick((function(){n.wrapDiv(i),i.originOffsetWidth=i.offsetWidth/n.getScale(),i.originOffsetHeight=i.offsetHeight/n.getScale(),i.style.transformOrigin="left top",i.style.width=i.originOffsetWidth+"px",i.style.height=i.originOffsetHeight+"px",n.handlerScale({el:i,value:o.value}),n.updateAdaptOptions.apply(n,t)}))},updated:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.updateAdaptOptions.apply(n,t)},unmounted:function(t){var e=n.adaptOptions.findIndex((function(e){return e.el===t}));e>-1&&n.adaptOptions.splice(e,1)}}))},this.wrapDiv=function(t){var e=document.createElement("div");e.style.width=a.px(t.offsetWidth),e.style.height=a.px(t.offsetHeight),e.style.overflow="hidden",t.parentNode.replaceChild(e,t),e.appendChild(t)},this.init=function(){a.nextTick((function(){a.handlerNormalMode(),window.addEventListener("resize",a.handlerNormalMode),window.addEventListener("pageshow",a.onPageShowHandlerNormalMode)}))},this.updateAdaptOptions=function(t,e){var n=a.adaptOptions.findIndex((function(e){return e.el===t})),i={el:t,value:e.value};n>-1?a.adaptOptions[n]=i:a.adaptOptions.push(i)},this.getScale=function(){return window.document.body.offsetWidth/(10*a.originRootFontSize)},this.handlerScale=function(t){var e=t.el,n=t.value,i=a.getScale();e.style.transform="scale(".concat(i,") translateZ(0)"),a.nextTick((function(){null==n||n(e,i)}))},this.setRootRemUnit=function(){a.rootFontSize=window.innerWidth/10,document.documentElement.style.fontSize=a.rootFontSize+"px"},this.setBodyFontSize=function(){document.body.style.fontSize=a.px(12),document.body.style.lineHeight="1"},this.handlerNormalMode=function(){var t,e;a.setRootRemUnit(),a.setBodyFontSize(),null===(t=a.externalCallbacks)||void 0===t||t.forEach((function(t){return null==t?void 0:t()})),null===(e=a.adaptOptions)||void 0===e||e.forEach(a.handlerScale)},this.onPageShowHandlerNormalMode=function(t){t.persisted&&a.handlerNormalMode()},this.px=function(t,e){if(void 0===e&&(e=!1),t)return e?(a.rootFontSize*t/a.originRootFontSize).toFixed(2):(t/a.originRootFontSize).toFixed(2)+"rem"},this.resetFontSize=function(){a.rootFontSize=0,document.body.style.fontSize="",document.body.style.lineHeight="",document.documentElement.style.fontSize=""},!o.rootValue)throw Error("使用ScreenAdapter时请传入rootValue");this.originRootFontSize=o.rootValue,this.nextTick=i.nextTick||e,(t||n)&&this.configVue(i),this.init()}return i.prototype.addListener=function(t){!this.externalCallbacks.includes(t)&&this.externalCallbacks.push(t)},i.prototype.removeListener=function(t){var e=this.externalCallbacks.indexOf(t);e>-1&&this.externalCallbacks.splice(e,1)},i.prototype.destroy=function(){this.resetFontSize(),this.externalCallbacks=[],this.adaptOptions=[],window.removeEventListener("resize",this.handlerNormalMode),window.removeEventListener("pageshow",this.onPageShowHandlerNormalMode)},i}(),o=t||n?{install:function(t,e){new i(t,e)}}:i;export{o as default};
